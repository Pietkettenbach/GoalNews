<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GoalNews - Live Spiele</title>
<style>
body { font-family: 'Poppins', sans-serif; background:#0f0f0f; color:#eee; text-align:center; }
h2 { margin:20px 0; }
.matches-table { width:95%; max-width:1200px; margin:20px auto; border-collapse: collapse; }
.matches-table th, .matches-table td { border:1px solid #444; padding:15px 20px; text-align:center; transition: all 0.5s ease; position: relative; font-size:1rem; }
.matches-table th { background:#1db954; color:#000; }
.goal-animation { background: #00ff00; color:#000; font-weight:bold; transform: scale(1.2); animation: pop 0.5s forwards; }
.over-game { text-decoration: line-through; opacity: 0.6; transition: all 0.5s ease; }
@keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.5); } 100% { transform: scale(1.2); } }
#nextGameCountdown { font-size: 1.5rem; margin: 15px 0; color:#1db954; }
footer { margin-top:30px; padding:15px; background:#111; color:#eee; }

/* Halbzeit Label */
.half-time-animation {
    position: absolute;
    top: 5px;
    right: 5px;
    background: rgba(29,185,84,0.9);
    color: #000;
    font-weight: bold;
    padding: 2px 8px;
    border-radius: 6px;
    font-size: 0.8rem;
    pointer-events: none;
    animation: halftimePulse 1.5s infinite alternate;
}
@keyframes halftimePulse {
    0% { transform: scale(1); opacity: 0.8; }
    50% { transform: scale(1.2); opacity: 1; }
    100% { transform: scale(1); opacity: 0.9; }
}

/* Uhr */
.match-timer {
    display: block;
    margin-top: 8px;
    font-size: 0.9rem;
    color: #1db954;
}
</style>
</head>
<body>

<h2>Live Spiele</h2>
<p>Alle Spiele sind live und im Gange</p>
<p>Durchgestrichene Spiele sind beendet</p>

<table class="matches-table">
<thead>
<tr><th>Heimteam</th><th>Gastteam</th><th>Ergebnis / Zeit</th></tr>
</thead>
<tbody id="tableBody">
<tr><td colspan="3">Lade Spiele...</td></tr>
</tbody>
</table>

<footer>GoalNews Â© 2025</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
import { getFirestore, collection, doc, setDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyBmIcdFtxv4jBJKdiAkEiwnkQ8yRwiG_0w",
    authDomain: "goalnewsde-community.firebaseapp.com",
    projectId: "goalnewsde-community",
    storageBucket: "goalnewsde-community.firebasestorage.app",
    messagingSenderId: "134523022055",
    appId: "1:134523022055:web:4f35ed7812d06e4fb55042"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const tableBody = document.getElementById("tableBody");

// Map fÃ¼r Spiel-Uhren
const matchTimers = new Map();

function addHalfTimeAnimation(tdElement) {
    if (!tdElement.querySelector('.half-time-animation')) {
        const overlay = document.createElement("div");
        overlay.className = "half-time-animation";
        overlay.textContent = "Halbzeit!";
        tdElement.appendChild(overlay);
    }
}

function removeHalfTimeAnimation(tdElement) {
    const overlay = tdElement.querySelector('.half-time-animation');
    if (overlay) overlay.remove();
}

function formatTime(ms) {
    const totalSeconds = Math.floor(ms / 1000);
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    return `${minutes}:${seconds.toString().padStart(2, "0")}`;
}

function startMatchTimer(id, td, startTime, halfTime) {
    // Wenn bereits lÃ¤uft â†’ abbrechen
    if (matchTimers.has(id)) clearInterval(matchTimers.get(id));

    let paused = halfTime;
    let elapsed = 0;
    const timerEl = document.createElement("span");
    timerEl.className = "match-timer";
    td.appendChild(timerEl);

    const interval = setInterval(() => {
        if (!paused) {
            elapsed = Date.now() - startTime;
            if (elapsed < 90 * 60 * 1000) {
                timerEl.textContent = `â±ï¸ ${formatTime(elapsed)}`;
            } else {
                timerEl.textContent = "ðŸ•› 90:00";
                clearInterval(interval);
            }
        } else {
            timerEl.textContent = "â¸ï¸ Halbzeit";
        }
    }, 1000);

    matchTimers.set(id, interval);
}

async function initLiveGames() {
    const colRef = collection(db, "liveGames");

    onSnapshot(colRef, async (snapshot) => {
        tableBody.innerHTML = "";
        if (snapshot.empty) {
            tableBody.innerHTML = "<tr><td colspan='3'>Keine aktuellen Spiele</td></tr>";
            return;
        }

        snapshot.forEach(doc => {
            const data = doc.data();
            if (doc.id === "next_game") return;

            const home = data.home || "";
            const away = data.away || "";
            const score = data.score || "";
            const goal = data.goal || false;
            const over = data.over || false;
            const halfTime = data.halfTime || false;
            const startTime = data.startTime ? data.startTime.toDate().getTime() : null;
            const homeCards = data.homeCards || {};
            const awayCards = data.awayCards || {};

            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td class="${over ? 'over-game' : ''}">
                    ${home} ${homeCards.yellow ? `ðŸŸ¨${homeCards.yellow}` : ""} ${homeCards.red ? `ðŸŸ¥${homeCards.red}` : ""}
                </td>
                <td class="${over ? 'over-game' : ''}">
                    ${away} ${awayCards.yellow ? `ðŸŸ¨${awayCards.yellow}` : ""} ${awayCards.red ? `ðŸŸ¥${awayCards.red}` : ""}
                </td>
                <td class="${goal ? 'goal-animation' : ''} ${over ? 'over-game' : ''}">
                    ${score}
                </td>
            `;
            tableBody.appendChild(tr);

            const scoreTd = tr.querySelector("td:nth-child(3)");

            if (halfTime) {
                addHalfTimeAnimation(scoreTd);
            } else {
                removeHalfTimeAnimation(scoreTd);
            }

            // Falls startTime existiert â†’ Uhr starten
            if (startTime) {
                startMatchTimer(doc.id, scoreTd, startTime, halfTime);
            }
        });
    });
}

initLiveGames();
</script>
</body>
</html>
