<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GoalNews Admin</title>

<style>
  body {
    margin:0; padding:0;
    background:linear-gradient(120deg,#000,#111);
    font-family:"Poppins",sans-serif;
    color:white;
  }

  header {
    background:linear-gradient(90deg,#8b0000,#006400);
    padding:18px;
    text-align:center;
    font-size:2rem;
    font-weight:700;
    box-shadow:0 0 25px gold;
  }

  .tabs {
    display:flex;
    justify-content:center;
    margin-top:20px;
  }

  .tab {
    padding:12px 25px;
    margin:0 6px;
    background:#222;
    border-radius:12px;
    cursor:pointer;
    font-weight:bold;
    transition:0.25s;
    box-shadow:0 0 10px rgba(255,255,255,0.1);
  }

  .tab:hover {
    background:#333;
    transform:translateY(-3px);
  }

  .tab.active {
    background:#006400;
    color:#ffd700;
    box-shadow:0 0 12px gold;
    transform:translateY(-4px);
  }

  .container {
    max-width:1100px;
    margin:30px auto;
    padding:10px;
  }

  .tabContent {
    display:none;
    animation:fade 0.35s ease;
  }
  .tabContent.active {
    display:block;
  }

  @keyframes fade {
    from {opacity:0}
    to {opacity:1}
  }

  .card {
    background:#222;
    padding:18px;
    border-radius:12px;
    margin:12px 0;
    display:flex;
    justify-content:space-between;
    align-items:center;
    transition:0.25s;
  }
  .card:hover {
    background:#333;
    transform:translateY(-3px);
  }

  button {
    padding:10px 20px;
    border:none;
    border-radius:8px;
    background:linear-gradient(90deg,#8b0000,#006400);
    font-weight:bold;
    color:white;
    cursor:pointer;
    transition:0.25s;
  }
  button:hover {
    background:linear-gradient(90deg,#ffd700,#ffa500);
    color:#111;
    transform:scale(1.05);
  }

  .statCard {
    background:#222;
    padding:25px;
    margin:15px;
    border-radius:12px;
    text-align:center;
    font-size:1.2rem;
    flex:1 1 220px;
    transition:0.25s;
  }
  .statCard:hover {
    background:#333;
    transform:translateY(-4px);
  }

  .statsWrap {
    display:flex;
    flex-wrap:wrap;
  }

</style>
</head>
<body>

<header>âš™ï¸ GoalNews Admin Dashboard</header>

<!-- TABS -->
<div class="tabs">
  <div class="tab active" data-tab="usersTab">ğŸ‘¤ Nutzer</div>
  <div class="tab" data-tab="statsTab">ğŸ“Š Statistiken</div>
  <div class="tab" data-tab="logsTab">ğŸ“œ Logs</div>
  <div class="tab" data-tab="settingsTab">âš™ï¸ Einstellungen</div>
</div>

<div class="container">

  <!-- Nutzer -->
  <div id="usersTab" class="tabContent active">
    <h2>ğŸ‘¤ Nutzerverwaltung</h2>
    <div id="userList">Lade Nutzer...</div>
  </div>

  <!-- Statistiken -->
  <div id="statsTab" class="tabContent">
    <h2>ğŸ“Š Statistiken</h2>

    <div class="statsWrap">
      <div class="statCard" id="totalUsers">Nutzer gesamt: ...</div>
      <div class="statCard" id="activeUsers">Aktive Nutzer: ...</div>
      <div class="statCard" id="totalCoins">Coins gesamt: ...</div>
      <div class="statCard" id="averageCoins">Durchschnitt Coins: ...</div>
      <div class="statCard" id="maxCoins">Max Coins: ...</div>
    </div>
  </div>

  <!-- Logs -->
  <div id="logsTab" class="tabContent">
    <h2>ğŸ“œ Logs</h2>
    <div id="logList">Lade Logs...</div>
  </div>

  <!-- Einstellungen -->
  <div id="settingsTab" class="tabContent">
    <h2>âš™ï¸ Einstellungen</h2>

    <button onclick="addAdmin()">â• Admin hinzufÃ¼gen</button>
    <br><br>
    <button onclick="toggleMaintenance()">ğŸ› ï¸ Wartungsmodus umschalten</button>

    <p id="maintenanceStatus"></p>
  </div>

</div>

<!-- FIREBASE -->
<script type="module">

  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
  import { getFirestore, doc, collection, getDocs, updateDoc, deleteDoc, addDoc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBmIcdFtxv4jBJKdiAkEiwnkQ8yRwiG_0w",
    authDomain: "goalnewsde-community.firebaseapp.com",
    projectId: "goalnewsde-community",
    storageBucket: "goalnewsde-community.firebasestorage.app",
    messagingSenderId: "134523022055",
    appId: "1:134523022055:web:4f35ed7812d06e4fb55042"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  // ğŸ”‘ Deine Admin UID
  const adminUIDs = ["gaPuzG1ULdUSskKUsciL1g79nh72", "5Oe5YOBOtfOGQsRJ3XUjr3kemnX2"];

  function logAction(action) {
    addDoc(collection(db,"logs"),{
      action: action,
      time: new Date(),
      admin: auth.currentUser.uid
    });
  }

  // ---- TABS ----
  const tabs = document.querySelectorAll(".tab");
  const contents = document.querySelectorAll(".tabContent");

  tabs.forEach(tab=>{
    tab.onclick = ()=>{
      tabs.forEach(t=>t.classList.remove("active"));
      tab.classList.add("active");

      contents.forEach(c=>c.classList.remove("active"));
      document.getElementById(tab.dataset.tab).classList.add("active");
    };
  });

  // ---- AUTH ----
  onAuthStateChanged(auth, user => {
    if(!user || !adminUIDs.includes(user.uid)){
      alert("Kein Zugriff!");
      location.href="login.html";
      return;
    }

    loadUsers();
    loadStats();
    loadLogs();
    loadSettings();
  });

  // ---- USERS ----
  async function loadUsers(){
    const userList = document.getElementById("userList");
    userList.innerHTML="";

    const snap = await getDocs(collection(db,"users"));
    snap.forEach(docSnap=>{
      const d = docSnap.data();

      const div = document.createElement("div");
      div.className="card";
      div.innerHTML = `
        <div>
          <b>${d.username || "Kein Name"}</b> (${d.email})
          <br>Coins: ${d.coins || 0}
        </div>

        <div>
          <button onclick="changeCoins('${docSnap.id}')">Coins Ã¤ndern</button>
          <button onclick="editUser('${docSnap.id}','${d.username}','${d.email}')">Bearbeiten</button>
          <button onclick="deleteUser('${docSnap.id}')">LÃ¶schen</button>
        </div>
      `;

      userList.appendChild(div);
    });
  }

  window.changeCoins = async uid =>{
    const amount = prompt("Neue Coins:");
    if(!amount) return;
    await updateDoc(doc(db,"users",uid),{coins:Number(amount)});
    logAction(`Coins geÃ¤ndert fÃ¼r ${uid} auf ${amount}`);
    loadUsers();
    loadStats();
  };

  window.editUser = async (uid,oldName,oldMail)=>{
    const nName = prompt("Name:", oldName);
    const nMail = prompt("Email:", oldMail);
    if(!nName || !nMail) return;

    await updateDoc(doc(db,"users",uid),{
      username:nName,
      email:nMail
    });
    logAction(`User bearbeitet: ${uid}`);
    loadUsers();
  };

  window.deleteUser = async uid =>{
    if(!confirm("Wirklich lÃ¶schen?")) return;

    await deleteDoc(doc(db,"users",uid));
    logAction(`User gelÃ¶scht: ${uid}`);
    loadUsers();
    loadStats();
  };

  // ---- STATS ----
  async function loadStats(){
    const snap = await getDocs(collection(db,"users"));

    let total=0, active=0, coins=0, maxC=0;

    snap.forEach(docSnap=>{
      const d = docSnap.data();
      total++;
      if(d.coins>0) active++;
      coins += d.coins || 0;
      if(d.coins>maxC) maxC = d.coins;
    });

    document.getElementById("totalUsers").innerText = `Nutzer gesamt: ${total}`;
    document.getElementById("activeUsers").innerText = `Aktive Nutzer: ${active}`;
    document.getElementById("totalCoins").innerText = `Coins gesamt: ${coins}`;
    document.getElementById("averageCoins").innerText = `Durchschnitt: ${(coins/total).toFixed(2)}`;
    document.getElementById("maxCoins").innerText = `Max Coins: ${maxC}`;
  }

  // ---- LOGS ----
  async function loadLogs(){
    const logList = document.getElementById("logList");
    logList.innerHTML="";

    const snap = await getDocs(collection(db,"logs"));
    snap.forEach(l=>{
      const d=l.data();
      const div=document.createElement("div");
      div.className="card";
      div.innerHTML = `
        <div>
          <b>${d.action}</b><br>
          <small>${new Date(d.time.toDate()).toLocaleString()}</small>
        </div>
      `;
      logList.appendChild(div);
    });
  }

  // ---- SETTINGS ----
  async function loadSettings(){
    const docRef = doc(db,"settings","main");
    const snap = await getDoc(docRef);
    const data = snap.exists() ? snap.data() : {};

    document.getElementById("maintenanceStatus").innerText =
      data.maintenance ? "ğŸŸ¥ Wartungsmodus: AKTIV" : "ğŸŸ© Wartungsmodus: Aus";
  }

  window.toggleMaintenance = async ()=>{
    const docRef = doc(db,"settings","main");
    const snap = await getDoc(docRef);
    const data = snap.exists() ? snap.data() : {};

    const newState = !data.maintenance;

    await setDoc(docRef,{ maintenance:newState },{merge:true});
    logAction("Wartungsmodus geÃ¤ndert");

    loadSettings();
  };

  window.addAdmin = async ()=>{
    const newID = prompt("Neue Admin UID eingeben:");
    if(!newID) return;

    alert("âš ï¸ Admins mÃ¼ssen im Code eingetragen werden!");
  };

</script>



</body>
</html>
