<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GoalNews - Foot- & Fu√üballnews</title>

    <!-- Favicon -->
    <link
      rel="icon"
      href="https://i.ibb.co/21R6p75W/Logo-1.jpg"
      type="image/jpeg"
    />
    <link rel="stylesheet" href="style.css" />

    <!-- PWA -->
    <meta name="theme-color" content="#1db954" />
    <meta
      name="description"
      content="GoalNews ‚Äì aktuelle Fu√üballnews, Live-Spiele & Experten-Tipps"
    />
    <meta property="og:title" content="GoalNews - Foot- & Fu√üballnews" />
    <meta
      property="og:description"
      content="Aktuelle Fu√üballnews, Live-Spiele, Experten-Tipps und Berichterstattung von der Bundesliga bis zum Afrika-Cup."
    />
    <meta property="og:image" content="https://i.ibb.co/21R6p75W/Logo-1.jpg" />
    <link rel="apple-touch-icon" href="https://i.ibb.co/21R6p75W/Logo-1.jpg" />
    <link rel="manifest" href="manifest.json" />

    <style>
      .gn-button {
        display: inline-block;
        margin: 40px auto;
        padding: 16px 34px;
        font-size: 1.05rem;
        font-weight: 700;
        letter-spacing: 0.5px;
        text-decoration: none;
        color: #0e1511;
        background: linear-gradient(135deg, #1db954, #7cffb2);
        border-radius: 999px;
        box-shadow:
          0 8px 25px rgba(29, 185, 84, 0.45),
          inset 0 0 0 rgba(255, 255, 255, 0);
        transition:
          transform 0.2s ease,
          box-shadow 0.2s ease,
          filter 0.2s ease;
      }

      .gn-button:hover {
        transform: translateY(-3px) scale(1.03);
        box-shadow: 0 14px 40px rgba(29, 185, 84, 0.7);
        filter: brightness(1.05);
      }

      .gn-button:active {
        transform: scale(0.97);
        box-shadow: 0 6px 15px rgba(29, 185, 84, 0.4);
      }

      /* ===== Allgemein ===== */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }

      body {
        background-color: #0f0f0f;
        color: #eee;
        overflow-x: hidden;
        text-align: center;
        line-height: 1.6;
      }

      /* Links */
      a {
        color: #1db954;
        text-decoration: none;
        transition: color 0.3s;
      }

      a:hover {
        color: #14a34a;
      }

      /* ===== Header ===== */
      header,
      .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: linear-gradient(90deg, #1db954, #14a34a);
        color: white;
        position: relative;
        z-index: 100;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
      }

      header .logo,
      .navbar .logo {
        font-size: 1.8rem;
        font-weight: bold;
        color: white;
      }

      /* ===== Hamburger ===== */
      .menu-toggle {
        display: none;
      }

      .hamburger-icon {
        display: flex !important;
        flex-direction: column;
        justify-content: space-between;
        width: 25px;
        height: 18px;
        cursor: pointer;
        z-index: 101;
      }

      .bar {
        height: 3px;
        width: 100%;
        background: white;
        border-radius: 2px;
        transition: all 0.3s ease-in-out;
      }

      /* Menu */
      .nav-menu {
        list-style: none;
        display: flex;
        flex-direction: column;
        position: fixed;
        top: 0;
        right: -100%;
        width: 70%;
        height: 100%;
        background-color: #111;
        padding-top: 60px;
        gap: 20px;
        transition: right 0.3s ease-in-out;
      }

      .nav-menu li {
        text-align: center;
      }

      .nav-menu a {
        color: #1db954;
        font-size: 1.1rem;
      }

      #menu-toggle:checked ~ .nav-menu {
        right: 0;
      }

      /* Hamburger Animation */
      #menu-toggle:checked ~ .hamburger-icon .bar:nth-child(1) {
        transform: rotate(45deg) translate(5px, 5px);
      }
      #menu-toggle:checked ~ .hamburger-icon .bar:nth-child(2) {
        opacity: 0;
      }
      #menu-toggle:checked ~ .hamburger-icon .bar:nth-child(3) {
        transform: rotate(-45deg) translate(5px, -5px);
      }

      /* ===== Breaking News ===== */
      #breakingNews {
        background: #111;
        overflow: hidden;
        border-left: 4px solid #1db954;
        height: 40px;
        display: flex;
        align-items: center;
      }

      .news-wrapper {
        display: inline-flex;
        white-space: nowrap;
        animation: scrollNews 25s linear infinite;
      }

      .news-item {
        padding: 0 50px;
        font-weight: 600;
        color: #1db954;
        text-transform: uppercase;
        font-size: 0.9rem;
        flex-shrink: 0;
      }

      @keyframes scrollNews {
        0% {
          transform: translateX(0);
        }
        100% {
          transform: translateX(-50%);
        }
      }

      #breakingNews:hover .news-wrapper {
        animation-play-state: paused;
      }

      /* ===== Countdown ===== */
      .countdown-section {
        text-align: center;
        margin: 50px 0;
        color: #1db954;
      }

      /* √úberschrift kleiner */
      .countdown-section h2 {
        font-size: 1.8rem;
        margin-bottom: 15px;
        color: #1db954;
      }

      /* Countdown-Zeit gr√∂√üer und gleichm√§√üig */
      #countdown {
        font-size: 2.5rem; /* gr√∂√üer f√ºr die Zahlen */
        font-weight: bold;
        color: #fff;
        letter-spacing: 2px; /* optional f√ºr gleichm√§√üiges Layout */
        font-family: "Courier New", monospace; /* alle Zahlen gleich gro√ü */
      }

      /* ===== Matches ===== */
      .matches {
        padding: 30px 20px;
        max-width: 950px;
        margin: auto;
        background: #111;
        border-radius: 15px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
      }

      .matches h2 {
        color: #1db954;
        margin-bottom: 15px;
      }

      .matches h3,
      .matches h4 {
        margin-bottom: 10px;
      }

      .topspiel {
        color: #14a34a;
      }

      /* ===== Footer ===== */
      footer {
        text-align: center;
        padding: 25px;
        background: #111;
        font-size: 0.9rem;
        color: #aaa;
      }

      /* ===== Responsive ===== */
      @media (max-width: 768px) {
        .matches {
          padding: 20px 15px;
        }
        .countdown-section h2 {
          font-size: 1.5rem;
        }
      }

      @media (max-width: 480px) {
        .news-item {
          padding: 0 20px;
          font-size: 0.8rem;
        }
        .socials {
          flex-direction: column;
          gap: 12px;
        }
        .matches {
          padding: 15px 10px;
        }
      }

      /* ==========================================================
   DEIN ZUS√ÑTZLICHER LIVE-MATCH CODE (voll integriert)
   ========================================================== */

      body {
        font-family: "Poppins", sans-serif;
        background: #0f0f0f;
        color: #eee;
        text-align: center;
        margin: 0;
        user-select: none;
      }

      h2 {
        margin: 20px 0;
        color: #1db954;
      }

      /* Tabelle Live Spiele */
      .matches-table {
        width: 95%;
        max-width: 1200px;
        margin: 20px auto;
        border-collapse: collapse;
      }
      .matches-table th,
      .matches-table td {
        border: 1px solid #444;
        padding: 15px 20px;
        text-align: center;
        transition: all 0.5s ease;
        position: relative;
        font-size: 1rem;
      }

      .matches-table th {
        background: #1db954;
        color: #000;
      }

      .goal-animation {
        background: #00ff00;
        color: #000;
        font-weight: bold;
        transform: scale(1.2);
        animation: pop 0.5s forwards;
      }

      .over-game {
        text-decoration: line-through;
        opacity: 0.6;
        transition: all 0.5s ease;
      }

      @keyframes pop {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.5);
        }
        100% {
          transform: scale(1.2);
        }
      }

      #nextGameCountdown {
        font-size: 1.5rem;
        margin: 15px 0;
        color: #1db954;
      }

      footer {
        margin-top: 30px;
        padding: 15px;
        background: #111;
        color: #eee;
      }

      /* Halbzeit Label */
      .half-time-animation {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(29, 185, 84, 0.9);
        color: #000;
        font-weight: bold;
        padding: 2px 8px;
        border-radius: 6px;
        font-size: 0.8rem;
        pointer-events: none;
        animation: halftimePulse 1.5s infinite alternate;
      }

      @keyframes halftimePulse {
        0% {
          transform: scale(1);
          opacity: 0.8;
        }
        50% {
          transform: scale(1.2);
          opacity: 1;
        }
        100% {
          transform: scale(1);
          opacity: 0.9;
        }
      }

      /* Uhr */
      .match-timer {
        display: block;
        margin-top: 8px;
        font-size: 0.9rem;
        color: #1db954;
      }

      /* VAR Kommentar */
      .var-comment {
        display: block;
        margin-top: 5px;
        background: linear-gradient(135deg, #ffd700, #ffea70);
        color: #000;
        font-weight: bold;
        padding: 4px 12px;
        border-radius: 8px;
        font-size: 0.9rem;
        opacity: 0;
        transform: translateY(20px) scale(0.8);
        animation:
          varCool 1.5s ease forwards,
          varGlow 2s ease-in-out infinite alternate;
        text-align: center;
      }

      @keyframes varCool {
        0% {
          opacity: 0;
          transform: translateY(20px) scale(0.8);
        }
        50% {
          opacity: 1;
          transform: translateY(-5px) scale(1.1);
        }
        70% {
          transform: translateY(0) scale(1);
        }
        100% {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      @keyframes varGlow {
        0% {
          box-shadow: 0 0 5px rgba(255, 223, 0, 0.6);
        }
        50% {
          box-shadow: 0 0 15px rgba(255, 255, 200, 0.9);
        }
        100% {
          box-shadow: 0 0 5px rgba(255, 223, 0, 0.6);
        }
      }

      /* Sperranimation Breaking News */
      #breakingNews.locked {
        position: relative;
        pointer-events: none;
        height: 50px;
        overflow: hidden;
      }
      #breakingNews.locked::before {
        content: "üîí Breaking News gesperrt! Kaufe sie mit COINS";
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        color: #1db954;
        font-weight: bold;
        font-size: 1.2rem;
        animation: lockSlide 2s infinite alternate;
      }
      #breakingNews.locked .news-wrapper {
        display: none;
      }

      @keyframes lockSlide {
        0% {
          transform: translateX(-50%) translateY(0);
          opacity: 0.6;
        }
        50% {
          transform: translateX(-50%) translateY(-5px);
          opacity: 1;
        }
        100% {
          transform: translateX(-50%) translateY(0);
          opacity: 0.6;
        }
      }
    </style>
  </head>

  <body>
    <!-- Breaking News -->
    <div
      id="breakingNews"
      class="locked"
      role="region"
      aria-live="polite"
      aria-atomic="true"
    >
      <div class="news-wrapper">
        <span class="news-item">
          üî¥ Arsenal k√§mpft sich ins Carabao-Cup-Halbfinale durch Penalty-Drama
          gegen Crystal Palace
        </span>
        <span class="news-item">
          üè¥ Man City verpflichtet Bournemouth-St√ºrmer Antoine Semenyo im
          Winter-Transferfenster
        </span>
        <span class="news-item">
          üëë Real-Madrid-Talent Endrick wechselt f√ºr den Rest der Saison auf
          Leihbasis zu Olympique Lyon
        </span>
        <span class="news-item">
          üá∏üá≥ Senegal startet mit einem 3:0-Sieg gegen Botswana in den Afrika-Cup
        </span>
        <span class="news-item">
          üí∏ Martha Stewart wird Miteigent√ºmerin von Swansea City ‚Äì gemeinsam
          mit Snoop Dogg und Luka Modriƒá
        </span>
      </div>
    </div>

    <!-- Header -->
    <header class="navbar" role="navigation" aria-label="Hauptnavigation">
      <div class="logo">GoalNews</div>
      <input type="checkbox" id="menu-toggle" class="menu-toggle" />
      <label
        for="menu-toggle"
        class="hamburger-icon"
        role="button"
        tabindex="0"
        aria-controls="nav-menu"
        aria-expanded="false"
        aria-label="Men√º"
      >
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
      </label>
      <ul class="nav-menu" id="nav-menu">
        <li><a href="√ºber_uns.html">About Us</a></li>
        <li><a href="experten-tipp.html">Experten-Tipp</a></li>
        <li><a href="votings.html">Abstimmungen</a></li>
        <li><a href="login.html">Login/Registrieren</a></li>
        <li><a href="bundesliga.html">Bundesliga</a></li>
        <li><a href="2liga.html">2. Bundesliga</a></li>
        <li><a href="comments.html">Kommentar Forum</a></li>
        <li><a href="feedback.html">Helfen Sie uns!</a></li>
        <li><a href="coins.html">Was sind COINS</a></li>
        <li><a href="download.html">Downloads/PDFs</a></li>
        <li>
          <a href="https://whatsapp.com/channel/0029Vb7PDwN8V0toB3ATWZ1Y"
            >WhatsApp</a
          >
        </li>
        <li><a href="https://www.youtube.com/@Goalnewsde">YouTube</a></li>
      </ul>
    </header>

    <!-- Afrika-Cup Button -->
    <a href="africa-cup.html" class="gn-button"> Africa Cup ansehen </a>

    <!-- Countdown -->
    <h2>‚è±Ô∏è 16. Spieltag startet in:</h2>
    <div id="countdown">lade...</div>

    <!-- üèÜ Bundesliga Spieltag -->
    <div class="matches" style="text-align: center; margin-top: 40px">
      <h2>üèÜ Bundesliga-Spieltag 16</h2>
      <h3>16. Spieltag (9. - 11. Januar)</h3>
      <div>
        <h4>Freitag, 9.1.2026:</h4>
        <p>Eintracht Frankfurt 20:30 Bor. Dortmund</p>
        <h4>Samstag, 10.1.2026:</h4>
        <p>
          SC Freiburg 15:30 Hamburger SV<br />
          Werder Bremen 15:30 TSG Hoffenheim<br />
          Union Berlin 15:30 Mainz 05<br />
          FC St. Pauli 15:30 RB Leipzig<br />
          1. FC Heidenheim 15:30 1. FC K√∂ln<br />
          <strong class="topspiel">
            Topspiel: Bayer Leverkusen 18:30 VfB Stuttgart
          </strong>
        </p>
        <h4>Sonntag, 11.1.2026:</h4>
        <p>
          Bor. M'galdbach 15:30 FC Augsburg<br />
          Bayern M√ºnchen 17:30 VfL Wolfsburg
        </p>
      </div>
    </div>

    <!-- Live Spiele -->
    <section id="liveGamesSection">
      <h2>Live Spiele</h2>
      <p>Alle Spiele sind live und im Gange</p>
      <p>Durchgestrichene Spiele sind beendet</p>
      <p>
        Unser Experten Tipp Gibt es auf unserer
        <a href="experten-tipp.html">Experten Seite</a>
      </p>
      <table class="matches-table">
        <thead>
          <tr>
            <th>Heimteam</th>
            <th>Gastteam</th>
            <th>Ergebnis / Zeit</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <tr>
            <td colspan="3">Lade Spiele...</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Footer -->
    <footer>
      ¬© 2025 GoalNews | Don't Steal Our Stuff
      <br />
      <a href="mailto:info@goalnewsde.de">Email</a> |
      <a href="agb.html">Datenschutz</a> |
      <a href="security.html">Sicherheit</a> |
      <a href="Impressum.html">Impressum</a>
    </footer>

    <!-- Scripts -->
    <script>
      // Countdown
      const countdownEl = document.getElementById("countdown");
      // Use explicit Date constructor (month is 0-based) to avoid inconsistent
      // string parsing across browsers
      const targetDate = new Date(2026, 0, 9, 20, 30, 0); // 9. Jan 2026 20:30 local time
      function updateCountdown() {
        const now = new Date();
        let diff = targetDate - now;
        if (diff <= 0) {
          countdownEl.textContent = "l√§uft!";
          return;
        }
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        diff %= 1000 * 60 * 60 * 24;
        const hours = Math.floor(diff / (1000 * 60 * 60));
        diff %= 1000 * 60 * 60;
        const minutes = Math.floor(diff / (1000 * 60));
        diff %= 1000 * 60;
        const seconds = Math.floor(diff / 1000);
        const parts = [];
        if (days > 0) parts.push(`${days}d`);
        if (hours > 0) parts.push(`${hours}h`);
        if (minutes > 0) parts.push(`${minutes}m`);
        parts.push(`${seconds}s`);
        countdownEl.textContent = parts.join(" ");
      }
      updateCountdown();
      const __countdownInterval = setInterval(updateCountdown, 1000);
      // clear interval on unload
      window.addEventListener("beforeunload", () =>
        clearInterval(__countdownInterval),
      );
    </script>

    <script>
      // keyboard support for the hamburger label and sync aria-expanded
      (function () {
        const checkbox = document.getElementById("menu-toggle");
        const label = document.querySelector('label[for="menu-toggle"]');
        const nav = document.getElementById("nav-menu");
        if (!label || !checkbox || !nav) return;

        function updateAria() {
          const expanded = checkbox.checked;
          label.setAttribute("aria-expanded", expanded ? "true" : "false");
        }

        // toggle checkbox on Enter/Space when label is focused
        label.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            checkbox.checked = !checkbox.checked;
            updateAria();
          }
        });

        // also update when checkbox changes (e.g. click)
        checkbox.addEventListener("change", updateAria);
        // init
        updateAria();
      })();
    </script>

    <script>
      // Service Worker registration (if supported)
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("/HTML/sw.js")
            .then((reg) => {
              console.log("Service Worker registered:", reg.scope);
            })
            .catch((err) => console.warn("SW registration failed:", err));
        });
      }
    </script>

    <script type="module">
      // Firebase + Live Games
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        doc,
        onSnapshot,
      } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
      import {
        getAuth,
        onAuthStateChanged,
        setPersistence,
        browserLocalPersistence,
      } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBmIcdFtxv4jBJKdiAkEiwnkQ8yRwiG_0w",
        authDomain: "goalnewsde-community.firebaseapp.com",
        projectId: "goalnewsde-community",
        storageBucket: "goalnewsde-community.firebasestorage.app",
        messagingSenderId: "134523022055",
        appId: "1:134523022055:web:4f35ed7812d06e4fb55042",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);
      setPersistence(auth, browserLocalPersistence);

      function watchMaintenance() {
        const docRef = doc(db, "settings", "main");
        const __unwatch = onSnapshot(docRef, (snap) => {
          if (snap.exists()) {
            const data = snap.data();
            if (data.maintenance === true)
              window.location.href = "wartungsarbeiten.html";
          } else {
            console.error("‚ùå Einstellungen nicht gefunden");
          }
        });
        __unsubscribes.push(__unwatch);
      }
      watchMaintenance();

      const breakingEl = document.getElementById("breakingNews");
      // keep a reference to auth unsubscribe and per-user doc unsubscribe
      const __authUnsub = onAuthStateChanged(auth, (user) => {
        if (!user) {
          breakingEl.classList.add("locked");
          if (__userDocUnsub) {
            __userDocUnsub();
            __userDocUnsub = null;
          }
          return;
        }
        const userRef = doc(db, "users", user.uid);
        // unsubscribe previous user doc listener if present
        if (__userDocUnsub) __userDocUnsub();
        __userDocUnsub = onSnapshot(userRef, (snap) => {
          const data = snap.data();
          if (data && data.breakingNews === true)
            breakingEl.classList.remove("locked");
          else breakingEl.classList.add("locked");
        });
        __unsubscribes.push(() => __userDocUnsub && __userDocUnsub());
      });
      __unsubscribes.push(__authUnsub);

      // Live Games
      const tableBody = document.getElementById("tableBody");
      const matchTimers = new Map();
      // map docId -> tr element for incremental updates
      const docRows = new Map();

      // Subscription cleanup helpers
      const __unsubscribes = [];
      let __userDocUnsub = null;
      let __liveGamesUnsub = null;

      function clearAllMatchTimers() {
        for (const [id, iv] of matchTimers) clearInterval(iv);
        matchTimers.clear();
      }

      // ensure we cleanup on page unload
      window.addEventListener("beforeunload", () => {
        clearAllMatchTimers();
        __unsubscribes.forEach((u) => u && u());
      });

      function addHalfTimeAnimation(td) {
        if (!td.querySelector(".half-time-animation")) {
          const overlay = document.createElement("div");
          overlay.className = "half-time-animation";
          overlay.textContent = "Halbzeit!";
          td.appendChild(overlay);
        }
      }

      function removeHalfTimeAnimation(td) {
        const overlay = td.querySelector(".half-time-animation");
        if (overlay) overlay.remove();
      }

      function formatTime(ms) {
        const totalSeconds = Math.floor(ms / 1000);
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        return `${minutes}:${seconds.toString().padStart(2, "0")}`;
      }

      function startMatchTimer(id, td, startTime, halfTime) {
        // clear old timer (if any)
        if (matchTimers.has(id)) clearInterval(matchTimers.get(id));
        let paused = !!halfTime;
        // reuse existing timer element if present
        let timerEl = td.querySelector(".match-timer");
        if (!timerEl) {
          timerEl = document.createElement("span");
          timerEl.className = "match-timer";
          td.appendChild(timerEl);
        }

        const interval = setInterval(() => {
          if (!paused) {
            const elapsed = Date.now() - startTime;
            if (elapsed < 90 * 60 * 1000)
              timerEl.textContent = `‚è±Ô∏è ${formatTime(elapsed)}`;
            else {
              timerEl.textContent = "üïõ 90:00";
              clearInterval(interval);
            }
          } else timerEl.textContent = "‚è∏Ô∏è Halbzeit";
        }, 1000);

        matchTimers.set(id, interval);
      }

      function showVARComment(td, comment) {
        let varDiv = td.querySelector(".var-comment");
        if (!varDiv) {
          varDiv = document.createElement("span");
          varDiv.className = "var-comment";
          td.appendChild(varDiv);
        }
        varDiv.textContent = comment;
        varDiv.style.opacity = 1;
        setTimeout(() => (varDiv.style.opacity = 0), 5000);
      }

      // create safe table row (no innerHTML from remote data)
      function createMatchRow(data) {
        const tr = document.createElement("tr");

        const tdHome = document.createElement("td");
        tdHome.className = data.over ? "over-game" : "";
        tdHome.textContent = data.home || "";
        tr.appendChild(tdHome);

        const tdAway = document.createElement("td");
        tdAway.className = data.over ? "over-game" : "";
        tdAway.textContent = data.away || "";
        tr.appendChild(tdAway);

        const tdScore = document.createElement("td");
        tdScore.className =
          `${data.goal ? "goal-animation" : ""} ${data.over ? "over-game" : ""}`.trim();
        tdScore.textContent = data.score || "";
        tr.appendChild(tdScore);

        return { tr, tdScore };
      }

      async function initLiveGames() {
        const colRef = collection(db, "liveGames");
        // unsubscribe previous liveGames listener if any
        if (__liveGamesUnsub) {
          __liveGamesUnsub();
          __liveGamesUnsub = null;
        }
        __liveGamesUnsub = onSnapshot(colRef, (snapshot) => {
          // If there are no docs at all, clear rows and show empty state
          if (snapshot.empty) {
            // remove existing rows and timers
            for (const [id, tr] of docRows) {
              tr.remove();
              if (matchTimers.has(id)) {
                clearInterval(matchTimers.get(id));
                matchTimers.delete(id);
              }
            }
            docRows.clear();
            tableBody.innerHTML = "";
            const tr = document.createElement("tr");
            const td = document.createElement("td");
            td.setAttribute("colspan", "3");
            td.textContent = "Keine aktuellen Spiele";
            tr.appendChild(td);
            tableBody.appendChild(tr);
            return;
          }

          // Process incremental changes to avoid full rebuilds
          const changes = snapshot.docChanges();
          changes.forEach((change) => {
            const docSnap = change.doc;
            const id = docSnap.id;
            if (id === "next_game") return;
            const data = docSnap.data();

            if (change.type === "added") {
              const { tr, tdScore } = createMatchRow(data);
              tr.dataset.docId = id;
              tableBody.appendChild(tr);
              docRows.set(id, tr);
              if (data.halfTime) addHalfTimeAnimation(tdScore);
              if (data.startTime)
                startMatchTimer(
                  id,
                  tdScore,
                  data.startTime.toDate().getTime(),
                  data.halfTime,
                );
              if (data.varComment) showVARComment(tdScore, data.varComment);
            }

            if (change.type === "modified") {
              const tr = docRows.get(id);
              if (!tr) return;
              const tdHome = tr.children[0];
              const tdAway = tr.children[1];
              const tdScore = tr.children[2];
              tdHome.textContent = data.home || "";
              tdHome.className = data.over ? "over-game" : "";
              tdAway.textContent = data.away || "";
              tdAway.className = data.over ? "over-game" : "";
              tdScore.textContent = data.score || "";
              tdScore.className =
                `${data.goal ? "goal-animation" : ""} ${data.over ? "over-game" : ""}`.trim();
              if (data.halfTime) addHalfTimeAnimation(tdScore);
              else removeHalfTimeAnimation(tdScore);
              if (data.startTime)
                startMatchTimer(
                  id,
                  tdScore,
                  data.startTime.toDate().getTime(),
                  data.halfTime,
                );
              if (data.varComment) showVARComment(tdScore, data.varComment);
            }

            if (change.type === "removed") {
              const tr = docRows.get(id);
              if (tr) {
                tr.remove();
                docRows.delete(id);
              }
              if (matchTimers.has(id)) {
                clearInterval(matchTimers.get(id));
                matchTimers.delete(id);
              }
            }
          });
        });
        __unsubscribes.push(__liveGamesUnsub);
      }
      initLiveGames();
    </script>
  </body>
</html>
